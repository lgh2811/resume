                                                                                                                                                                                                                                                                
libname data '';                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
PROC IMPORT DATAFILE="C:/Users/lgh2811/Desktop/projects/bank-full.csv"                                                                                                                                                                                          
OUT=data.bank DBMS=csv REPLACE;                                                                                                                                                                                                                                 
GETNAMES=YES;                                                                                                                                                                                                                                                   
RUN;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
title1 'bank';                                                                                                                                                                                                                                                  
proc print data=bank (obs=10);                                                                                                                                                                                                                                  
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
title2 'Simple Random Sampling';                                                                                                                                                                                                                                
proc surveyselect data=bank                                                                                                                                                                                                                                     
   method=srs n=45211 out=bank;                                                                                                                                                                                                                                 
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
/*                                                                                                                                                                                                                                                              
data training;                                                                                                                                                                                                                                                  
set bank (obs=27127);                                                                                                                                                                                                                                           
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data validation;                                                                                                                                                                                                                                                
set bank (firstobs=27128 obs=36169);                                                                                                                                                                                                                            
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data testing;                                                                                                                                                                                                                                                   
set bank (firstobs=36170);                                                                                                                                                                                                                                      
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
*/                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
data data.boston;                                                                                                                                                                                                                                               
  infile 'housing.data';                                                                                                                                                                                                                                        
  input x1 - x13 y;                                                                                                                                                                                                                                             
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
%macro grnn_learn(data = , x = , y = , sigma = , nn_out = );                                                                                                                                                                                                    
options mprint mlogic nocenter;                                                                                                                                                                                                                                 
********************************************************;                                                                                                                                                                                                       
* THIS MACRO IS TO TRAIN A GENERAL REGRESSION NEURAL   *;                                                                                                                                                                                                       
* NETWORK (SPECHT, 1991) AND STORE THE SPECIFICATION   *;                                                                                                                                                                                                       
*------------------------------------------------------*;                                                                                                                                                                                                       
* INPUT PARAMETERS:                                    *;                                                                                                                                                                                                       
*  DATA  : INPUT SAS DATASET                           *;                                                                                                                                                                                                       
*  X     : A LIST OF PREDICTORS IN THE NUMERIC FORMAT  *;                                                                                                                                                                                                       
*  Y     : A RESPONSE VARIABLE IN THE NUMERIC FORMAT   *;                                                                                                                                                                                                       
*  SIGMA : THE SMOOTH PARAMETER FOR GRNN               *;                                                                                                                                                                                                       
*  NN_OUT: OUTPUT SAS DATASET CONTAINING THE GRNN      *;                                                                                                                                                                                                       
*          SPECIFICATION                               *;                                                                                                                                                                                                       
*------------------------------------------------------*;                                                                                                                                                                                                       
* AUTHOR:                                              *;                                                                                                                                                                                                       
*  WENSUI.LIU@53.COM<script cf-hash="f9e31" type="text/javascript">                                                                                                                                                                                             
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.prev
(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script>                                   *;                                                                                       
********************************************************;                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                
data _tmp1;                                                                                                                                                                                                                                                     
  set &data (keep = &x &y);                                                                                                                                                                                                                                     
  where &y ~= .;                                                                                                                                                                                                                                                
  array _x_ &x;                                                                                                                                                                                                                                                 
  _miss_ = 0;                                                                                                                                                                                                                                                   
  do _i_ = 1 to dim(_x_);                                                                                                                                                                                                                                       
    if _x_[_i_] = . then _miss_ = 1;                                                                                                                                                                                                                            
  end;                                                                                                                                                                                                                                                          
  if _miss_ = 0 then output;                                                                                                                                                                                                                                    
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc summary data = _tmp1;                                                                                                                                                                                                                                      
  output out = _avg_ (drop = _type_ _freq_)                                                                                                                                                                                                                     
  mean(&x) = ;                                                                                                                                                                                                                                                  
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc summary data = _tmp1;                                                                                                                                                                                                                                      
  output out = _std_ (drop = _type_ _freq_)                                                                                                                                                                                                                     
  std(&x) = ;                                                                                                                                                                                                                                                   
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc standard data = _tmp1 mean = 0 std = 1 out = _data_;                                                                                                                                                                                                       
  var &x;                                                                                                                                                                                                                                                       
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data &nn_out (keep = _neuron_ _key_ _value_);                                                                                                                                                                                                                   
  set _last_ end = eof;                                                                                                                                                                                                                                         
  _neuron_ + 1;                                                                                                                                                                                                                                                 
  length _key_ $32;                                                                                                                                                                                                                                             
  array _a_ &y &x;                                                                                                                                                                                                                                              
  do _i_ = 1 to dim(_a_);                                                                                                                                                                                                                                       
    if _i_ = 1 then _key_ = '_Y_';                                                                                                                                                                                                                              
    else _key_ = upcase(vname(_a_[_i_]));                                                                                                                                                                                                                       
    _value_ = _a_[_i_];                                                                                                                                                                                                                                         
    output;                                                                                                                                                                                                                                                     
  end;                                                                                                                                                                                                                                                          
  if eof then do;                                                                                                                                                                                                                                               
    _neuron_ = 0;                                                                                                                                                                                                                                               
    _key_  = "_SIGMA_";                                                                                                                                                                                                                                         
    _value_  = &sigma;                                                                                                                                                                                                                                          
    output;                                                                                                                                                                                                                                                     
    set _avg_;                                                                                                                                                                                                                                                  
    array _b_ &x;                                                                                                                                                                                                                                               
    do _i_ = 1 to dim(_b_);                                                                                                                                                                                                                                     
      _neuron_ = -1;                                                                                                                                                                                                                                            
      _key_ = upcase(vname(_b_[_i_]));                                                                                                                                                                                                                          
      _value_ = _b_[_i_];                                                                                                                                                                                                                                       
      output;                                                                                                                                                                                                                                                   
    end;                                                                                                                                                                                                                                                        
    set _std_;                                                                                                                                                                                                                                                  
    array _c_ &x;                                                                                                                                                                                                                                               
    do _i_ = 1 to dim(_c_);                                                                                                                                                                                                                                     
      _neuron_ = -2;                                                                                                                                                                                                                                            
      _key_ = upcase(vname(_c_[_i_]));                                                                                                                                                                                                                          
      _value_ = _c_[_i_];                                                                                                                                                                                                                                       
      output;                                                                                                                                                                                                                                                   
    end;                                                                                                                                                                                                                                                        
  end;                                                                                                                                                                                                                                                          
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc datasets library = work;                                                                                                                                                                                                                                   
  delete _: / memtype = data;                                                                                                                                                                                                                                   
run;                                                                                                                                                                                                                                                            
quit;                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                
********************************************************;                                                                                                                                                                                                       
*              END OF THE MACRO                        *;                                                                                                                                                                                                       
********************************************************;                                                                                                                                                                                                       
%mend grnn_learn;                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                
%grnn_learn(data = data.boston, x = x1 - x13, y = y, sigma = 0.55, nn_out = data.grnn);                                                                                                                                                                         
                                                                                                                                                                                                                                                                
proc print data = data.grnn (obs = 10) noobs;                                                                                                                                                                                                                   
run;                                                                                                                                                                                                                                                            
/* SAS PRINTOUT OF GRNN DATA:                                                                                                                                                                                                                                   
_neuron_    _key_     _value_                                                                                                                                                                                                                                   
    1        _Y_      24.0000                                                                                                                                                                                                                                   
    1        X1       -0.4194                                                                                                                                                                                                                                   
    1        X2        0.2845                                                                                                                                                                                                                                   
    1        X3       -1.2866                                                                                                                                                                                                                                   
    1        X4       -0.2723                                                                                                                                                                                                                                   
    1        X5       -0.1441                                                                                                                                                                                                                                   
    1        X6        0.4133                                                                                                                                                                                                                                   
    1        X7       -0.1199                                                                                                                                                                                                                                   
    1        X8        0.1401                                                                                                                                                                                                                                   
    1        X9       -0.9819                                                                                                                                                                                                                                   
*/                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
libname data '';                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
%macro grnn_pred(data = , x = , id = NA, nn_in = , out = grnn_pred);                                                                                                                                                                                            
options mprint mlogic nocenter;                                                                                                                                                                                                                                 
********************************************************;                                                                                                                                                                                                       
* THIS MACRO IS TO GENERATE PREDICTED VALUES BASED ON  *;                                                                                                                                                                                                       
* THE SPECIFICATION OF GRNN CREATED BY THE %GRNN_LEARN *;                                                                                                                                                                                                       
* MACRO                                                *;                                                                                                                                                                                                       
*------------------------------------------------------*;                                                                                                                                                                                                       
* INPUT PARAMETERS:                                    *;                                                                                                                                                                                                       
*  DATA : INPUT SAS DATASET                            *;                                                                                                                                                                                                       
*  X    : A LIST OF PREDICTORS IN THE NUMERIC FORMAT   *;                                                                                                                                                                                                       
*  ID   : AN ID VARIABLE (OPTIONAL)                    *;                                                                                                                                                                                                       
*  NN_IN: INPUT SAS DATASET CONTAINING THE GRNN        *;                                                                                                                                                                                                       
*         SPECIFICATION GENERATED FROM %GRNN_LEARN     *;                                                                                                                                                                                                       
*  OUT  : OUTPUT SAS DATASET WITH GRNN PREDICTIONS     *;                                                                                                                                                                                                       
*------------------------------------------------------*;                                                                                                                                                                                                       
* AUTHOR:                                              *;                                                                                                                                                                                                       
*  WENSUI.LIU@53.COM<script cf-hash="f9e31" type="text/javascript">                                                                                                                                                                                             
/* <![CDATA[ */!function(){try{var t="currentScript"in document?document.currentScript:function(){for(var t=document.getElementsByTagName("script"),e=t.length;e--;)if(t[e].getAttribute("cf-hash"))return t[e]}();if(t&&t.previousSibling){var e,r,n,i,c=t.prev
(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]> */</script>                                   *;                                                                                       
********************************************************;                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                
data _data_;                                                                                                                                                                                                                                                    
  set &data;                                                                                                                                                                                                                                                    
  array _x_ &x;                                                                                                                                                                                                                                                 
  _miss_ = 0;                                                                                                                                                                                                                                                   
  do _i_ = 1 to dim(_x_);                                                                                                                                                                                                                                       
    if _x_[_i_] = . then _miss_ = 1;                                                                                                                                                                                                                            
  end;                                                                                                                                                                                                                                                          
  if _miss_ = 0 then output;                                                                                                                                                                                                                                    
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data _data_;                                                                                                                                                                                                                                                    
  set _last_ (drop = _miss_);                                                                                                                                                                                                                                   
  %if &id = NA %then %do;                                                                                                                                                                                                                                       
  _id_ + 1;                                                                                                                                                                                                                                                     
  %end;                                                                                                                                                                                                                                                         
  %else %do;                                                                                                                                                                                                                                                    
  _id_ = &id;                                                                                                                                                                                                                                                   
  %end;                                                                                                                                                                                                                                                         
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc sort data = _last_ sortsize = max nodupkey;                                                                                                                                                                                                                
  by _id_;                                                                                                                                                                                                                                                      
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
data _data_ (keep = _id_ _key_ _value_);                                                                                                                                                                                                                        
  set _last_;                                                                                                                                                                                                                                                   
  array _x_ &x;                                                                                                                                                                                                                                                 
  length _key_ $32;                                                                                                                                                                                                                                             
  do _i_ = 1 to dim(_x_);                                                                                                                                                                                                                                       
    _key_ = upcase(vname(_x_[_i_]));                                                                                                                                                                                                                            
    _value_ = _x_[_i_];                                                                                                                                                                                                                                         
    output;                                                                                                                                                                                                                                                     
  end;                                                                                                                                                                                                                                                          
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
proc sql noprint;                                                                                                                                                                                                                                               
select _value_ ** 2 into :s2 from &nn_in where _neuron_ = 0;                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                
create table                                                                                                                                                                                                                                                    
  _last_ as                                                                                                                                                                                                                                                     
select                                                                                                                                                                                                                                                          
  a._id_,                                                                                                                                                                                                                                                       
  a._key_,                                                                                                                                                                                                                                                      
  (a._value_ - b._value_) / c._value_ as _value_                                                                                                                                                                                                                
from                                                                                                                                                                                                                                                            
  _last_ as a,                                                                                                                                                                                                                                                  
  &nn_in as b,                                                                                                                                                                                                                                                  
  &nn_in as c                                                                                                                                                                                                                                                   
where                                                                                                                                                                                                                                                           
  compress(a._key_, ' ') = compress(b._key_, ' ') and                                                                                                                                                                                                           
  compress(a._key_, ' ') = compress(c._key_, ' ') and                                                                                                                                                                                                           
  b._neuron_ = -1                                 and                                                                                                                                                                                                           
  c._neuron_ = -2;                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                
create table                                                                                                                                                                                                                                                    
  _last_ as                                                                                                                                                                                                                                                     
select                                                                                                                                                                                                                                                          
  a._id_,                                                                                                                                                                                                                                                       
  b._neuron_,                                                                                                                                                                                                                                                   
  sum((a._value_ - b._value_) ** 2) as d2,                                                                                                                                                                                                                      
  mean(c._value_)                   as y,                                                                                                                                                                                                                       
  exp(-(calculated d2) / (2 * &s2)) as exp                                                                                                                                                                                                                      
from                                                                                                                                                                                                                                                            
  _last_  as a,                                                                                                                                                                                                                                                 
  &nn_in as b,                                                                                                                                                                                                                                                  
  &nn_in as c                                                                                                                                                                                                                                                   
where                                                                                                                                                                                                                                                           
  compress(a._key_, ' ') = compress(b._key_, ' ') and                                                                                                                                                                                                           
  b._neuron_ = c._neuron_                         and                                                                                                                                                                                                           
  b._neuron_ > 0                                  and                                                                                                                                                                                                           
  c._key_ = '_Y_'                                                                                                                                                                                                                                               
group by                                                                                                                                                                                                                                                        
  a._id_, b._neuron_;                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                
create table                                                                                                                                                                                                                                                    
  _last_ as                                                                                                                                                                                                                                                     
select                                                                                                                                                                                                                                                          
  a._id_,                                                                                                                                                                                                                                                       
  sum(a.y * a.exp / b.sum_exp) as _pred_                                                                                                                                                                                                                        
from                                                                                                                                                                                                                                                            
  _last_ as a inner join (select _id_, sum(exp) as sum_exp from _last_ group by _id_) as b                                                                                                                                                                      
on                                                                                                                                                                                                                                                              
  a._id_ = b._id_                                                                                                                                                                                                                                               
group by                                                                                                                                                                                                                                                        
  a._id_;                                                                                                                                                                                                                                                       
quit;                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                
proc sort data = _last_ out = &out sortsize = max;                                                                                                                                                                                                              
  by _id_;                                                                                                                                                                                                                                                      
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
********************************************************;                                                                                                                                                                                                       
*              END OF THE MACRO                        *;                                                                                                                                                                                                       
********************************************************;                                                                                                                                                                                                       
%mend grnn_pred;                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
/*input of dataset*/                                                                                                                                                                                                                                            
proc contents data=bank;                                                                                                                                                                                                                                        
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
%grnn_learn(data = data.bank, x = age balance campaign, y = y, sigma = 0.55, nn_out = data.grnn);                                                                                                                                                               
                                                                                                                                                                                                                                                                
proc print data = bank.grnn (obs = 10) noobs;                                                                                                                                                                                                                   
run;                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                
%grnn_pred(data = data.boston, x = x1 - x13, nn_in = data.grnn);                                                                                                                                                                                                
                                                                                                                                                                                                                                                                
proc print data = grnn_pred (obs = 10) noobs;                                                                                                                                                                                                                   
run;                                                                                                                                                                                                                                                            
/* SAS PRINTOUT:                                                                                                                                                                                                                                                
_id_     _pred_                                                                                                                                                                                                                                                 
  1     24.6156                                                                                                                                                                                                                                                 
  2     23.2223                                                                                                                                                                                                                                                 
  3     32.2961                                                                                                                                                                                                                                                 
  4     32.5770                                                                                                                                                                                                                                                 
  5     33.2955                                                                                                                                                                                                                                                 
  6     26.7348                                                                                                                                                                                                                                                 
  7     21.4602                                                                                                                                                                                                                                                 
  8     20.9683                                                                                                                                                                                                                                                 
  9     16.5554                                                                                                                                                                                                                                                 
 10     20.2525                                                                                                                                                                                                                                                 
*/
